<div class="container">
  <!-- Header -->
  <div class="header">
    <h1>ğŸ“ Todo App - RxJS Demo</h1>
    <button (click)="onRefresh()" class="btn-refresh">
      <span>ğŸ”„</span> Recharger
    </button>
  </div>

  <!-- Concepts dÃ©montrÃ©s -->
  <div class="concepts-box">
    <h3>ğŸ¯ Concepts RxJS dÃ©montrÃ©s</h3>
    <div class="concepts-grid">
      <span>forkJoin</span>
      <span>debounceTime</span>
      <span>filter</span>
      <span>switchMap</span>
      <span>combineLatest</span>
      <span>catchError</span>
      <span>tap</span>
      <span>retry</span>
      <span>CRUD complet</span>
    </div>
  </div>

  <!-- Formulaire d'ajout -->
  <div *ngIf="!(loading$ | async)" class="add-todo-form">
    <h3>â• Ajouter un nouveau todo</h3>
    <div class="add-todo-input-group">
      <input
        type="text"
        [formControl]="newTodoControl"
        placeholder="Titre du nouveau todo..."
        (keyup.enter)="onAddTodo()"
      />
      <button (click)="onAddTodo()" class="btn-add">Ajouter</button>
    </div>
    <small class="info-text">
      ğŸ’¡ Note : JSONPlaceholder simule l'ajout (pas de persistance rÃ©elle)
    </small>
  </div>

  <!-- Loading -->
  <div *ngIf="loading$ | async" class="loading">
    <div class="spinner"></div>
    <p>Chargement des donnÃ©es (forkJoin)...</p>
  </div>

  <!-- Filtres -->
  <div *ngIf="!(loading$ | async)" class="filters">
    <!-- Recherche -->
    <div class="search-box">
      <input
        type="text"
        [formControl]="searchControl"
        placeholder="Rechercher un todo... (debounceTime 300ms)"
      />
    </div>

    <!-- Filtres -->
    <div class="filter-grid">
      <div>
        <label>Statut</label>
        <select [formControl]="statusControl">
          <option value="all">Tous</option>
          <option value="active">Actifs</option>
          <option value="completed">ComplÃ©tÃ©s</option>
        </select>
      </div>

      <div>
        <label>Utilisateur</label>
        <select [formControl]="userControl">
          <option value="all">Tous les utilisateurs</option>
          <option *ngFor="let user of (users$ | async)" [value]="user.id">
            {{ user.name }}
          </option>
        </select>
      </div>

      <div>
        <label>Statistiques</label>
        <div class="stats" *ngIf="stats$ | async as stats">
          <div class="stat-completed">âœ“ {{ stats.completed }}</div>
          <div class="stat-active">â—‹ {{ stats.active }}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- RÃ©sultats -->
  <div *ngIf="!(loading$ | async) && (filteredTodos$ | async) as todos" class="results-count">
    <strong>ğŸ“Š {{ todos.length }}</strong> rÃ©sultat(s)
  </div>

  <!-- Liste des todos -->
  <div *ngIf="!(loading$ | async)" class="todo-list">
    <div
      *ngFor="let todo of filteredTodos$ | async"
      class="todo-item"
      [class.editing]="editingTodoId === todo.id"
    >
      <!-- Mode Ã©dition -->
      <div *ngIf="editingTodoId === todo.id" class="edit-mode">
        <input
          type="text"
          [formControl]="editTodoControl"
          class="edit-input"
          (keyup.enter)="onUpdateTodo(todo.id)"
          (keyup.escape)="cancelEdit()"
        />
        <div class="edit-actions">
          <button (click)="onUpdateTodo(todo.id)" class="btn-save">ğŸ’¾ Sauver</button>
          <button (click)="cancelEdit()" class="btn-cancel">âŒ Annuler</button>
        </div>
      </div>

      <!-- Mode normal -->
      <div *ngIf="editingTodoId !== todo.id" class="normal-mode">
        <div class="todo-checkbox" (click)="onToggleTodo(todo.id)">
          <span *ngIf="todo.completed" class="checked">âœ“</span>
          <span *ngIf="!todo.completed" class="unchecked">â—‹</span>
        </div>

        <div class="todo-content">
          <p [class.completed]="todo.completed">{{ todo.title }}</p>
          <small>
            ğŸ‘¤ {{ getUserName(todo.userId) | async }} â€¢ ID: {{ todo.id }}
          </small>
        </div>

        <div class="todo-actions">
          <button (click)="startEdit(todo)" class="btn-edit" title="Modifier">
            âœï¸
          </button>
          <button (click)="onDeleteTodo(todo.id, todo.title)" class="btn-delete" title="Supprimer">
            ğŸ—‘ï¸
          </button>
        </div>

        <div class="todo-status">
          <span *ngIf="todo.completed" class="badge-completed">ComplÃ©tÃ©</span>
          <span *ngIf="!todo.completed" class="badge-active">En cours</span>
        </div>
      </div>
    </div>

    <div *ngIf="(filteredTodos$ | async)?.length === 0" class="empty-state">
      Aucun todo trouvÃ© avec ces filtres
    </div>
  </div>
</div>

